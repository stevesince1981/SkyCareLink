<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provide Quote - {{ quote.booking_id }} - SkyCareLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="#">
            <i class="fas fa-helicopter me-2"></i>SkyCareLink Affiliate
        </a>
    </div>
</nav>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-file-invoice-dollar me-2"></i>
                        Provide Quote - {{ quote.booking_id }}
                    </h4>
                </div>
                
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-muted">Route</h6>
                            <p class="mb-0">
                                <strong>From:</strong> {{ quote.pickup_location }}<br>
                                <strong>To:</strong> {{ quote.destination }}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Transport Date</h6>
                            <p class="mb-0">{{ quote.transport_date.strftime('%B %d, %Y') }}</p>
                        </div>
                    </div>
                    
                    {% if quote.patient_condition or quote.special_requirements %}
                    <div class="row mb-4">
                        {% if quote.patient_condition %}
                        <div class="col-md-6">
                            <h6 class="text-muted">Patient Condition</h6>
                            <p class="mb-0">{{ quote.patient_condition }}</p>
                        </div>
                        {% endif %}
                        {% if quote.special_requirements %}
                        <div class="col-md-6">
                            <h6 class="text-muted">Special Requirements</h6>
                            <p class="mb-0">{{ quote.special_requirements }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <hr>
                    
                    <form id="quoteForm" onsubmit="submitQuote(event)">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="quoted_price" class="form-label">
                                    <strong>Price (USD) *</strong>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="quoted_price" 
                                           name="quoted_price" step="0.01" min="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">&nbsp;</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ground_included" 
                                           name="ground_included">
                                    <label class="form-check-label" for="ground_included">
                                        Ground transport included
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" 
                                      placeholder="Additional information about your service..."></textarea>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Submit Quote
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function submitQuote(event) {
    event.preventDefault();
    
    const form = document.getElementById('quoteForm');
    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
    
    fetch(`/affiliate/submit_quote/{{ quote.booking_id }}`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Quote submitted successfully! The customer will be notified.');
            window.location.href = '/';
        } else {
            alert('Error: ' + data.message);
            // Re-enable submit button
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Submit Quote';
        }
    })
    .catch(error => {
        alert('Error submitting quote. Please try again.');
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Submit Quote';
    });
}
</script>

</body>
</html>