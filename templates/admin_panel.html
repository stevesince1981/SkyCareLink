{% extends "base.html" %}

{% block title %}Admin Panel - SkyCareLink{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-cogs me-2"></i>Admin Panel</h2>
            <div>
                <a href="{{ url_for('admin_storyboard') }}" class="btn btn-info me-2">
                    <i class="fas fa-chart-line me-1"></i>Revenue Storyboard
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
        
        <!-- Key Metrics -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h4>{{ stats.total_bookings }}</h4>
                        <small>Total Bookings</small>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h4>${{ "{:,}".format(stats.actual_revenue|int) }}</h4>
                        <small>SkyCareLink Revenue</small>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h4>${{ "{:,}".format(stats.total_service_value|int) }}</h4>
                        <small>Service Value</small>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h4>${{ "{:,}".format(stats.deposits_collected|int) }}</h4>
                        <small>Deposits</small>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card bg-secondary text-white">
                    <div class="card-body text-center">
                        <h4>${{ "{:,}".format(stats.commission_earned|int) }}</h4>
                        <small>Commission</small>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card bg-dark text-white">
                    <div class="card-body text-center">
                        <h4>{{ "%.1f"|format(stats.conversion_rate * 100) }}%</h4>
                        <small>Conversion</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Revenue Analysis -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>SkyCareLink Revenue Analysis</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Revenue per Booking:</strong> ${{ "{:,}".format((stats.actual_revenue / stats.total_bookings)|int) }}</p>
                        <p><strong>Deposit Collection:</strong> $1,000 Ã— {{ stats.total_bookings }} = ${{ "{:,}".format(stats.deposits_collected|int) }}</p>
                        <p><strong>Commission (5%):</strong> ${{ "{:,}".format(stats.commission_earned|int) }}</p>
                        <p><strong>Goal Progress:</strong> {{ "%.1f"|format((stats.total_bookings / stats.goals.booking_goal) * 100) }}% of {{ stats.goals.booking_goal }}-booking goal</p>
                        
                        <!-- Progress bar -->
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{ (stats.total_bookings / stats.goals.booking_goal) * 100 }}%" 
                                 aria-valuenow="{{ stats.total_bookings }}" aria-valuemin="0" aria-valuemax="{{ stats.goals.booking_goal }}">
                                {{ stats.total_bookings }}/{{ stats.goals.booking_goal }} bookings
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Modifiable Goals & Projections</h5>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="mb-2">
                                <label class="form-label">Booking Goal:</label>
                                <input type="number" class="form-control form-control-sm" value="{{ stats.goals.booking_goal }}" readonly>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Monthly Target:</label>
                                <input type="number" class="form-control form-control-sm" value="{{ stats.goals.monthly_booking_target }}" readonly>
                            </div>
                        </form>
                        <hr>
                        <p><strong>Q1 Projection:</strong> ${{ "{:,}".format((stats.actual_revenue * 3)|int) }}</p>
                        <p><strong>Annual Projection:</strong> ${{ "{:,}".format((stats.actual_revenue * 12)|int) }}</p>
                        <small class="text-muted">Based on ${{ "{:,}".format((stats.actual_revenue / stats.total_bookings)|int) }} per booking</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Recent Activity</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Activity</th>
                                        <th>Revenue</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Today</td>
                                        <td>Critical Transport - Denver to Miami</td>
                                        <td>$128,500</td>
                                        <td><span class="badge bg-success">Completed</span></td>
                                    </tr>
                                    <tr>
                                        <td>Yesterday</td>
                                        <td>Emergency Evacuation - Seattle to Phoenix</td>
                                        <td>$112,000</td>
                                        <td><span class="badge bg-success">Completed</span></td>
                                    </tr>
                                    <tr>
                                        <td>2 days ago</td>
                                        <td>Neonatal Transport - Austin to Houston</td>
                                        <td>$102,000</td>
                                        <td><span class="badge bg-success">Completed</span></td>
                                    </tr>
                                    <tr>
                                        <td>3 days ago</td>
                                        <td>Organ Transport - Los Angeles to Portland</td>
                                        <td>$95,000</td>
                                        <td><span class="badge bg-success">Completed</span></td>
                                    </tr>
                                    <tr>
                                        <td>4 days ago</td>
                                        <td>ICU Patient - Chicago to Atlanta</td>
                                        <td>$118,000</td>
                                        <td><span class="badge bg-success">Completed</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}